<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/WEB-INF/template/layoutWithoutForm.xhtml">

    <ui:define name="siteTitle">库存管理系统-产品信息</ui:define>
    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="menuCode" value="#{supportDataMaintainView.menuCode}"/>
            <f:viewAction action="#{supportDataMaintainView.loadData}" onPostback="false"/>
        </f:metadata>
    </ui:define>

    <ui:define name="breadCrumbText">产品信息</ui:define>
    <ui:define name="mainContentContainer">
        <p:tabView id="tabView" style="margin-left: 5px;">
            <p:tab id="tab1" title="产品列表1">
                <h:form prependId="false" id="form1">
                    <h:panelGrid id="searchProdCriteria" columns="7">
                        <h:outputLabel for="prodType" value="产品类型:"/>
                        <p:selectOneMenu id="prodType" value="#{supportDataMaintainView.prodSearchCriteria.prodCategoryCode}">
                            <f:selectItem itemLabel="所有产品类型" itemValue=""/>
                            <f:selectItems value="#{supportDataMaintainView.prodCategoryList}" var="category"
                                           itemLabel="#{category.categoryName}" itemValue="#{category.categoryName}"/>
                            <p:ajax update="productsTable" listener="#{supportDataMaintainView.filterProductInfoList}" process="searchProdCriteria"/>
                        </p:selectOneMenu>

                        <h:outputLabel value=" &#160;&#160;&#160;"></h:outputLabel>
                        <h:outputLabel for="prodCode" value="产品代号: "/>
                        <p:inputText id="prodCode" value="#{supportDataMaintainView.prodSearchCriteria.prodCode}"/>

                        <h:outputLabel value=" &#160;&#160;&#160;"></h:outputLabel>
                        <p:commandButton id="btn_searchProdInfo" value="查找" process="searchProdCriteria" update="productsTable" action="#{supportDataMaintainView.searchProdInfo}">
                        </p:commandButton>
                    </h:panelGrid>
                    <br/>
                    <p:outputPanel id="productInfo">
                        <p:dataTable id="productsTable" value="#{supportDataMaintainView.productList}" var="product"
                                     paginator="true" rows="10"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} ">

                            <p:column styleClass="table_header">
                                <f:facet name="header">
                                    <h:outputText value="产品代码"/>
                                </f:facet>
                                <h:outputText value="#{product.productCode}"/>
                            </p:column>

                            <p:column styleClass="table_header">
                                <f:facet name="header">
                                    <h:outputText value="产品类别"/>
                                </f:facet>
                                <h:outputText value="#{product.categoryCode}"/>
                            </p:column>

                            <p:column styleClass="table_header">
                                <f:facet name="header">
                                    <h:outputText value="产品价格"/>
                                </f:facet>
                                <h:outputText value="#{product.price}"/>
                            </p:column>

                            <p:column styleClass="table_header">
                                <f:facet name="header">
                                    <h:outputText value="产品图片"/>
                                </f:facet>
                                <p:graphicImage
                                        value="/resources/upload/#{product.pictureName}"/>
                            </p:column>

                            <p:column styleClass="table_header">
                                <f:facet name="header">
                                    <h:outputText value="操作"/>
                                </f:facet>
                                <p:commandLink style="margin-right:20px;" update=":tabView:form1" ajax="true" process="@this"
                                               oncomplete="PF('productDialog').show()">
                                    <h:outputText value="编辑"/>
                                    <f:setPropertyActionListener value="edit" target="#{supportDataMaintainView.action}"/>
                                    <f:setPropertyActionListener value="#{product}"
                                                                 target="#{supportDataMaintainView.selectedProductInfo}"/>
                                </p:commandLink>

                                <p:commandLink id="delete" style="margin-right:20px;"
                                               action="#{supportDataMaintainView.deleteProductInfo}" process="@this"
                                               update=":tabView:form1"
                                               immediate="true">
                                    <h:outputText value="删除"/>
                                    <f:setPropertyActionListener value="#{product}"
                                                                 target="#{supportDataMaintainView.selectedProductInfo}"/>
                                    <f:setPropertyActionListener value="delete" target="#{supportDataMaintainView.action}"/>
                                </p:commandLink>
                            </p:column>

                        </p:dataTable>
                    </p:outputPanel>
                    <ui:include src="widget/prod_info_edit.xhtml"></ui:include>
                </h:form>
            </p:tab>
            <p:tab id="tab2" title="新增产品">
                <h:form prependId="false" id="form2">
                    <p:panel header="新增单个产品" >
                        <h:panelGrid columns="2" cellpadding="4" id="addSingleProdInfo">
                            <h:outputText value="产品代码:"/>
                            <h:inputText value="#{supportDataMaintainView.newProductInfo.productCode}"/>

                            <h:outputText value="产品类别:"/>
                            <p:selectOneMenu id="newProdType" value="#{supportDataMaintainView.newProductInfo.categoryCode}">
                                <f:selectItems value="#{supportDataMaintainView.prodCategoryList}" var="category"
                                               itemLabel="#{category.categoryName}" itemValue="#{category.categoryName}"/>
                            </p:selectOneMenu>

                            <h:outputText value="产品价格:"/>
                            <h:inputText value="#{supportDataMaintainView.newProductInfo.price}"/>

                            <h:outputText value="产品图片:"/>
                            <h:inputText value="#{supportDataMaintainView.newProductInfo.price}"/>

                            <p:commandButton id="btn_add" value="保存"
                                             update=":tabView:form2" validateClient="true" ajax="true" process="addSingleProdInfo"
                                             action="#{supportDataMaintainView.addProductInfo}">
                                <f:setPropertyActionListener value="list" target="#{supportDataMaintainView.action}"/>
                            </p:commandButton>

                        </h:panelGrid>
                        <p:messages autoUpdate="false"/>
                    </p:panel>
                    <br/>
                    <p:panel header="批量上传产品" id="addMultipleProdInfo">
                        请先点击<u><a href="#{request.contextPath}/resources/download/productInfo.xlsx" target="_self "
                                  style="color: blue;"> 这里 </a></u>下载产品信息模板
                        <br/>


                        <p:fileUpload fileUploadListener="#{fileUploadController.handleFileUpload}" mode="advanced"
                                      dragDropSupport="false" process="addMultipleProdInfo"
                                      sizeLimit="1000000" allowTypes="/(\.|\/)(gif|jpe?g|png|xls|xlsx)$/" update="@this"
                                      label="选择文件" uploadLabel="上传" cancelLabel="取消">
                            <f:attribute name="fileType" value="prodInfoList"/>

                        </p:fileUpload>
                        <h:inputText value="#{fileUploadController.fileCode}" />
                    </p:panel>
                </h:form>
            </p:tab>

            <p:tab id="tab3" title="产品图片上传">
                <h:form prependId="false" id="form3">
                    <p:fileUpload fileUploadListener="#{fileUploadController.handleFileUpload}" mode="advanced"
                                  dragDropSupport="false"
                                  sizeLimit="1000000" allowTypes="/(\.|\/)(gif|jpe?g|png|xls|xlsx)$/" update="form3"
                                  label="选择文件" uploadLabel="上传" cancelLabel="取消">
                        <f:attribute name="fileType" value="prodInfoList"/>
                    </p:fileUpload>

                    <p:commandButton rendered="false" id="downloadLink" value="Download" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop)"
                                     icon="ui-icon-arrowthichk-s">
                        <p:fileDownload value="#{fileDownloadController.file}" />
                    </p:commandButton>

                    <p:commandButton rendered="true" id="syncProdToStock" value="同步产品" ajax="false" action="#{supportDataMaintainView.syncProdInfoToProdStock}">
                    </p:commandButton>
                </h:form>
            </p:tab>


        </p:tabView>


    </ui:define>
</ui:composition>